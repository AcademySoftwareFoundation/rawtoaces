# RAW to ACES Utility


The RAW to ACES Utility or `rawtoaces`, is a software package that converts Camera RAW file to Academy Color Encoding System (ACES) compliant container through two main channels:

* XYZ/D65 (generated by libraw) to ACES colorspace by a fixed conversion matrix;

* CameraRAW RGB (generated by libraw) to ACES colorspace by calculating an Input Device Transform (IDT) matrix based on the camera's sensitivity and a specified type of light sources or an optimal light source.

The output image complies with the  `ACES Container` specification (*SMPTE S2065-4*).

### Package Contents

The source code contains the following:

* cmake/ - CMake modules for locating dependencies (e.g.,  `libraw `)
* config/ - CMake configuration files
* data/ - plain and formatted files that contain camera sensitivity, light source, color matching function and 190 training patch data
* lib/ - IDT libraries and the math library
* main.cpp, rawtoaces.h - C++ source code files that call routines to process image processing.
* usage.h - C++ header files contains  `rawtoaces` usage information


### Installation Prerequisites

**Required**

###### CMake

CMake can be downloaded directly from [https://cmake.org/]() and/or installed using one of the commands below.

* Ubuntu

	```sh
	$ sudo apt-get install cmake
	```

* Redhat

	```sh
	$ yum install cmake
	```

* OS X

	Install homebrew if not already installed
	
	```sh
	$ ruby -e "$(curl -fsSL https://raw.github.com/Homebrew/homebrew/go/install)"
	```
	
	Install cmake
	
	```sh
	$ brew install cmake
	```

###### IlmBase

The rawtoaces depends on an essential part of IlmBase software package, which can be downloaded from [http://www.openexr.com]() and/or installed using one of the commands below.

* Ubuntu

	```sh
	$ sudo apt-get install libilmbase-dev
	```

* Redhat

	```sh
	$ yum install ilmbase-devel
	```

* OS X

	Install homebrew if not already installed
	
	```sh
	$ ruby -e "$(curl -fsSL https://raw.github.com/Homebrew/homebrew/go/install)"
	```
	
	Install ilmBase
	
	```sh
	$ brew install ilmBase
	```

###### OpenEXR

As the outcome is in the OpenEXR image file format, you should download OpenEXR. OpenEXR can be downloaded from [http://www.openexr.com/downloads.html]() and/or installed using one of the commands below.

* Ubuntu

	```sh
	$ sudo apt-get install libopenexr-dev
	```

* Redhat

	```sh
	$ yum install OpenEXR-devel
	```

* OS X

	Install homebrew if not already installed
	
	```sh
	$ ruby -e "$(curl -fsSL https://raw.github.com/Homebrew/homebrew/go/install)"
	```
	
	Install OpenEXR
	
	```sh
	$ brew install openexr
	```
	
###### Aces Container 

Aces Container is the reference implementation for a file writer intended to be used with the Academy Color Encoding System (ACES). `rawtoaces` relies on it to produce images that comply with the ACES container specification (SMPTE S2065-4). LibRaw can be downloaded from [https://github.com/ampas/aces_container]() or installed using one of the commands below.

* Ubuntu / Redhat / OS X
	
	Install aces-container
	
	```sh
	git clone git@github.com:miaoqi/aces_container.git
	git checkout windowBuildSupport

	mkdir build && cd build
	cmake ..
	make
	sudo make install	
	```

###### LibRaw

LibRaw is the library that obtains RAW files from digital cameras. It handles image pre-processing for rawtoaces. LibRaw can be downloaded from [http://www.libraw.org/download]() or installed using one of the commands below.

* Ubuntu

	```sh
	$ sudo apt-get install libraw-dev
	```

* Redhat

	```sh
	$ yum install libraw1394-devel
	```

* OS X

	Install homebrew if not already installed
	
	```sh
	$ ruby -e "$(curl -fsSL https://raw.github.com/Homebrew/homebrew/go/install)"
	```
	
	Install OpenEXR
	
	```sh
	$ brew install libraw
	```
	
###### Ceres Solver

Ceres Solver is an open source library for solving Non-linear Least Squares problems with bounds constraints and unconstrained optimization problems. It processes non-linear regression for rawtoaces. Ceres Solver can be downloaded from [http://ceres-solver.org/]() or installed using one of the commands below.

* Linux (e.g. Ubuntu)

	Install `google-glog + gflags`
	
	``` sh
	sudo apt-get install libgoogle-glog-dev
	```
	
	Install `BLAS & LAPACK`
	
	``` sh
	sudo apt-get install libatlas-base-dev
	```
	
	Install `Eigen3`

	``` sh
	sudo apt-get install libeigen3-dev
	```
	
   Install `SuiteSparse and CXSparse` (*optional*)
   
   	``` sh
	sudo apt-get install libsuitesparse-dev
	sudo add-apt-repository ppa:bzindovic/suitesparse-bugfix-1319687
	sudo apt-get update
	sudo apt-get install libsuitesparse-dev
	```

	
   Build, Test and Install `Ceres`
	
	``` sh
	tar zxf ceres-solver-version#.tar.gz
	mkdir ceres-bin
	cd ceres-bin
	cmake ../ceres-solver-version#
	make -j3
	make test
	sudo make install
	```

* OS X

	Install homebrew if not already installed
	
	```sh
	$ ruby -e "$(curl -fsSL https://raw.github.com/Homebrew/homebrew/go/install)"
	```
	
	Install OpenEXR
	
	```sh
	$ brew install ceres-solver --HEAD
	```

### Installation

* OS X

	Install homebrew if not already installed

	```sh
	$ ruby -e "$(curl -fsSL https://raw.github.com/mxcl/homebrew/go)"
	```

	Install rawtoaces

	```sh
	$ (coming soon ...)
	```

*  From Source

	From the root source directory:

	```sh
	$ mkdir build && cd build
	$ cmake ..
	$ make
	$ sudo make install
	```

	The default process will install `librawtoacesIDT.dylib` to `/usr/local/lib`, a few header files to `/usr/local/include/RAWTOACES` and a number of data files into `/usr/local/include/RAWTOACES`


### License

The Raw to ACES Utility Reference Implementation is provided by the Academy under the following terms and conditions:

Copyright © 2015 Academy of Motion Picture Arts and Sciences ("A.M.P.A.S."). Portions contributed by others as indicated. All rights reserved.

A worldwide, royalty-free, non-exclusive right to copy, modify, create derivatives, and use, in source and binary forms, is hereby granted, subject to acceptance of this license. Performance of any of the aforementioned acts indicates acceptance to be bound by the following terms and conditions:

Copies of source code, in whole or in part, must retain the above copyright notice, this list of conditions and the Disclaimer of Warranty.

Use in binary form must retain the above copyright notice, this list of conditions and the Disclaimer of Warranty in the documentation and/or other materials provided with the distribution.

Nothing in this license shall be deemed to grant any rights to trademarks, copyrights, patents, trade secrets or any other intellectual property of A.M.P.A.S. or any contributors, except as expressly stated herein.

Neither the name "A.M.P.A.S." nor the name of any other contributors to this software may be used to endorse or promote products derivative of or based on this software without express prior written permission of A.M.P.A.S. or the contributors, as appropriate.

This license shall be construed pursuant to the laws of the State of California, and any disputes related thereto shall be subject to the jurisdiction of the courts therein.

Disclaimer of Warranty: THIS SOFTWARE IS PROVIDED BY A.M.P.A.S. AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, AND NON-INFRINGEMENT ARE DISCLAIMED. IN NO EVENT SHALL A.M.P.A.S., OR ANY CONTRIBUTORS OR DISTRIBUTORS, BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, RESITUTIONARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

WITHOUT LIMITING THE GENERALITY OF THE FOREGOING, THE ACADEMY SPECIFICALLY DISCLAIMS ANY REPRESENTATIONS OR WARRANTIES WHATSOEVER RELATED TO PATENT OR OTHER INTELLECTUAL PROPERTY RIGHTS IN THE RAW TO ACES UTILITY REFERENCE IMPLEMENTATION, OR APPLICATIONS THEREOF, HELD BY PARTIES OTHER THAN A.M.P.A.S., WHETHER DISCLOSED OR UNDISCLOSED.

Where indicated source code derived from or provided courtesy of:

License Terms for the RAW TO ACES UTILITY

The RAW TO ACES UTILITY is provided by Adobe Systems Incorporated under the following terms and conditions:

Copyright © 2015 Adobe Systems Incorporated ("Adobe"). All rights reserved.

A worldwide, royalty-free, non-exclusive right to copy, modify, create derivatives, and use, in source and binary forms, is hereby granted, subject to acceptance of this license. Performance of any of the aforementioned acts indicates acceptance to be bound by the following terms and conditions:

Copies of source code, in whole or in part, must retain the above copyright notice, this list of conditions and the Disclaimer of Warranty.

Use in binary form must retain the above copyright notice, this list of conditions and the Disclaimer of Warranty in the documentation and/or other materials provided with the distribution.

Nothing in this license shall be deemed to grant any rights to trademarks, copyrights, patents, trade secrets or any other intellectual property of Adobe or any contributors, except as expressly stated herein.

Neither the name "Adobe" nor the name of any other contributors to this software may be used to endorse or promote products derivative of or based on this software without express prior written permission of Adobe or the contributors, as appropriate.

This license shall be construed pursuant to the laws of the State of California, and any disputes related thereto shall be subject to the jurisdiction of the courts therein.

Disclaimer of Warranty: THIS SOFTWARE IS PROVIDED BY ADOBE AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, AND NON-INFRINGEMENT ARE DISCLAIMED. IN NO EVENT SHALL ADOBE, OR ANY CONTRIBUTORS OR DISTRIBUTORS, BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, RESITUTIONARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

WITHOUT LIMITING THE GENERALITY OF THE FOREGOING, ADOBE SPECIFICALLY DISCLAIMS ANY REPRESENTATIONS OR WARRANTIES WHATSOEVER RELATED TO PATENT OR OTHER INTELLECTUAL PROPERTY RIGHTS IN RAW TO ACES UTILITY, OR APPLICATIONS THEREOF, HELD BY PARTIES OTHER THAN ADOBE, WHETHER DISCLOSED OR UNDISCLOSED.

MD5C.C - RSA Data Security, Inc., MD5 message-digest algorithm

Copyright (C) 1991-2, RSA Data Security, Inc. Created 1991. All rights reserved.

License to copy and use this software is granted provided that it is identified as the "RSA Data Security, Inc. MD5 Message-Digest Algorithm" in all material mentioning or referencing this software or this function.

License is also granted to make and use derivative works provided that such works are identified as "derived from the RSA Data Security, Inc. MD5 Message-Digest Algorithm" in all material mentioning or referencing the derived work.

RSA Data Security, Inc. makes no representations concerning either the merchantability of this software or the suitability of this software for any particular purpose. It is provided "as is" without express or implied warranty of any kind.

These notices must be retained in any copies of any part of this documentation and/or software.
